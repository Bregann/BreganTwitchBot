@page "/usersearch/{Username?}"

@using Data.UserSearch
@inject UserSearchService UserSearchService


<MudText Typo="Typo.h2" Align="Align.Center" Class="pt-7 pb-5" Style="color: white;">User Search</MudText>

<MudContainer MaxWidth="MaxWidth.Large" Style="overflow: hidden">
    <MudTextField @bind-Value="@userSearchText" Label="Twitch Username" Variant="Variant.Outlined" Adornment="Adornment.End" OnAdornmentClick="x => HandleAdornmentClick(x)" AdornmentIcon="@Icons.Filled.Search" Immediate=false TextChanged="HandleTextChanged"/>

@if(userSearch == null && firstRender)
{
    <MudAlert Severity="Severity.Info">Use the search above to find the user data!</MudAlert>
}

@if(userSearch != null)
{
    <MudAlert Severity="Severity.Success">User found</MudAlert>

    <MudText Typo="Typo.h3" Align="Align.Center" Class="pt-7 pb-5" Style="color: white;">General</MudText>

    <MudGrid Justify="Justify.Center">
        <MudItem xs=3>
            <MudPaper Style="@($"background-color: {Colors.LightBlue.Darken1}; color: white; ")" Elevation=5>
                <MudText Align="Align.Center" Class="pt-4" Typo="Typo.h6">User ID</MudText>
                <MudText Align="Align.Center" Class="pt-1 pb-4" Typo="Typo.body1">@userSearch.UserId</MudText>
            </MudPaper>
        </MudItem>
        <MudItem xs=3>
            <MudPaper Style="@($"background-color: {Colors.LightBlue.Darken1}; color: white;")" Elevation=5>
                <MudText Align="Align.Center" Class="pt-4" Typo="Typo.h6">Twitch Username</MudText>
                <MudText Align="Align.Center" Class="pt-1 pb-4" Typo="Typo.body1">@userSearch.TwitchUsername</MudText>
            </MudPaper>
        </MudItem>
        <MudItem xs=3>
            <MudPaper Style="@($"background-color: {Colors.LightBlue.Darken1}; color: white;")" Elevation=5>
                <MudText Align="Align.Center" Class="pt-4" Typo="Typo.h6">Total Messages Sent</MudText>
                <MudText Align="Align.Center" Class="pt-1 pb-4" Typo="Typo.body1">@userSearch.MessagesSent.ToString("N0")</MudText>
            </MudPaper>
        </MudItem>
        <MudItem xs=3>
            <MudPaper Style="@($"background-color: {Colors.LightBlue.Darken1}; color: white;")" Elevation=5>
                <MudText Align="Align.Center" Class="pt-4" Typo="Typo.h6">Last Seen Date</MudText>
                <MudText Align="Align.Center" Class="pt-1 pb-4" Typo="Typo.body1">@userSearch.LastSeenDate</MudText>
            </MudPaper>
        </MudItem>
    </MudGrid>

    <MudText Typo="Typo.h3" Align="Align.Center" Class="pt-7 pb-5" Style="color: white;">Hours</MudText>

    <MudGrid Justify="Justify.Center">
        <MudItem xs=3>
            <MudPaper Style="@($"background-color: {Colors.Red.Darken2}; color: white;")" Elevation=5>
                <MudText Align="Align.Center" Class="pt-4" Typo="Typo.h6">Total Minutes In Stream</MudText>
                <MudText Align="Align.Center" Class="pt-1 pb-4" Typo="Typo.body1">@userSearch.MinutesInStream</MudText>
            </MudPaper>
        </MudItem>
        <MudItem xs=3>
            <MudPaper Style="@($"background-color: {Colors.Red.Darken2}; color: white;")" Elevation=5>
                <MudText Align="Align.Center" Class="pt-4" Typo="Typo.h6">Minutes Watched This Stream</MudText>
                <MudText Align="Align.Center" Class="pt-1 pb-4" Typo="Typo.body1">@userSearch.MinutesWatchedThisStream</MudText>
            </MudPaper>
        </MudItem>
        <MudItem xs=3>
            <MudPaper Style="@($"background-color: {Colors.Red.Darken2}; color: white;")" Elevation=5>
                <MudText Align="Align.Center" Class="pt-4" Typo="Typo.h6">Minutes Watched This Week</MudText>
                <MudText Align="Align.Center" Class="pt-1 pb-4" Typo="Typo.body1">@userSearch.MinutesWatchedThisWeek</MudText>
            </MudPaper>
        </MudItem>
        <MudItem xs=3>
            <MudPaper Style="@($"background-color: {Colors.Red.Darken2}; color: white;")" Elevation=5>
                <MudText Align="Align.Center" Class="pt-4" Typo="Typo.h6">Minutes Watched This Month</MudText>
                <MudText Align="Align.Center" Class="pt-1 pb-4" Typo="Typo.body1">@userSearch.MinutesWatchedThisMonth</MudText>
            </MudPaper>
        </MudItem>
    </MudGrid>

    <MudText Typo="Typo.h3" Align="Align.Center" Class="pt-7 pb-5" Style="color: white;">Gambling</MudText>

    <MudGrid Justify="Justify.Center">
        <MudItem xs=3>
            <MudPaper Style="@($"background-color: {Colors.Green.Darken2}; color: white;")" Elevation=5>
                <MudText Align="Align.Center" Class="pt-4" Typo="Typo.h6">Points Gambled</MudText>
                <MudText Align="Align.Center" Class="pt-1 pb-4" Typo="Typo.body1">@userSearch.PointsGambled.ToString("N0")</MudText>
            </MudPaper>
        </MudItem>
        <MudItem xs=3>
            <MudPaper Style="@($"background-color: {Colors.Green.Darken2}; color: white;")" Elevation=5>
                <MudText Align="Align.Center" Class="pt-4" Typo="Typo.h6">Points Won</MudText>
                <MudText Align="Align.Center" Class="pt-1 pb-4" Typo="Typo.body1">@userSearch.PointsWon.ToString("N0")</MudText>
            </MudPaper>
        </MudItem>
        <MudItem xs=3>
            <MudPaper Style="@($"background-color: {Colors.Green.Darken2}; color: white;")" Elevation=5>
                <MudText Align="Align.Center" Class="pt-4" Typo="Typo.h6">Points Lost</MudText>
                <MudText Align="Align.Center" Class="pt-1 pb-4" Typo="Typo.body1">@userSearch.PointsLost.ToString("N0")</MudText>
            </MudPaper>
        </MudItem>
        <MudItem xs=3>
            <MudPaper Style="@($"background-color: {Colors.Green.Darken2}; color: white;")" Elevation=5>
                <MudText Align="Align.Center" Class="pt-4" Typo="Typo.h6">Total Spins</MudText>
                <MudText Align="Align.Center" Class="pt-1 pb-4" Typo="Typo.body1">@userSearch.TotalSpins.ToString("N0")</MudText>
            </MudPaper>
        </MudItem>

        <MudItem xs=2>
            <MudPaper Style="@($"background-color: {Colors.Green.Darken2}; color: white;")" Elevation=5>
                <MudText Align="Align.Center" Class="pt-4" Typo="Typo.h6">Kappa Wins</MudText>
                <MudText Align="Align.Center" Class="pt-1 pb-4" Typo="Typo.body1">@userSearch.Tier1Wins.ToString("N0")</MudText>
            </MudPaper>
        </MudItem>
        <MudItem xs=2>
            <MudPaper Style="@($"background-color: {Colors.Green.Darken2}; color: white;")" Elevation=5>
                <MudText Align="Align.Center" Class="pt-4" Typo="Typo.h6">4Head Wins</MudText>
                <MudText Align="Align.Center" Class="pt-1 pb-4" Typo="Typo.body1">@userSearch.Tier2Wins.ToString("N0")</MudText>
            </MudPaper>
        </MudItem>
        <MudItem xs=2>
            <MudPaper Style="@($"background-color: {Colors.Green.Darken2}; color: white;")" Elevation=5>
                <MudText Align="Align.Center" Class="pt-4" Typo="Typo.h6">LUL Wins</MudText>
                <MudText Align="Align.Center" Class="pt-1 pb-4" Typo="Typo.body1">@userSearch.Tier3Wins.ToString("N0")</MudText>
            </MudPaper>
        </MudItem>
        <MudItem xs=2>
            <MudPaper Style="@($"background-color: {Colors.Green.Darken2}; color: white;")" Elevation=5>
                <MudText Align="Align.Center" Class="pt-4" Typo="Typo.h6">Jackpot Wins</MudText>
                <MudText Align="Align.Center" Class="pt-1 pb-4" Typo="Typo.body1">@userSearch.JackpotWins.ToString("N0")</MudText>
            </MudPaper>
        </MudItem>
        <MudItem xs=2>
            <MudPaper Style="@($"background-color: {Colors.Green.Darken2}; color: white;")" Elevation=5>
                <MudText Align="Align.Center" Class="pt-4" Typo="Typo.h6">SMOrc Wins</MudText>
                <MudText Align="Align.Center" Class="pt-1 pb-4" Typo="Typo.body1">@userSearch.SmorcWins.ToString("N0")</MudText>
            </MudPaper>
        </MudItem>
    </MudGrid>

    <MudText Typo="Typo.h3" Align="Align.Center" Class="pt-7 pb-5" Style="color: white;">Streak Stats</MudText>

    <MudGrid Justify="Justify.Center">
        <MudItem xs=3>
            <MudPaper Style="@($"background-color: {Colors.Orange.Darken3}; color: white;")" Elevation=5>
                <MudText Align="Align.Center" Class="pt-4" Typo="Typo.h6">Current Streak</MudText>
                <MudText Align="Align.Center" Class="pt-1 pb-4" Typo="Typo.body1">@userSearch.CurrentStreak.ToString("N0")</MudText>
            </MudPaper>
        </MudItem>
        <MudItem xs=3>
            <MudPaper Style="@($"background-color: {Colors.Orange.Darken3}; color: white;")" Elevation=5>
                <MudText Align="Align.Center" Class="pt-4" Typo="Typo.h6">Highest Streak</MudText>
                <MudText Align="Align.Center" Class="pt-1 pb-4" Typo="Typo.body1">@userSearch.HighestStreak.ToString("N0")</MudText>
            </MudPaper>
        </MudItem>
        <MudItem xs=3>
            <MudPaper Style="@($"background-color: {Colors.Orange.Darken3}; color: white;")" Elevation=5>
                <MudText Align="Align.Center" Class="pt-4" Typo="Typo.h6">Total Times Claimed</MudText>
                <MudText Align="Align.Center" Class="pt-1 pb-4" Typo="Typo.body1">@userSearch.TotalTimesClaimed.ToString("N0")</MudText>
            </MudPaper>
        </MudItem>
        <MudItem xs=3>
            <MudPaper Style="@($"background-color: {Colors.Orange.Darken3}; color: white;")" Elevation=5>
                <MudText Align="Align.Center" Class="pt-4" Typo="Typo.h6">Total Points Claimed</MudText>
                <MudText Align="Align.Center" Class="pt-1 pb-4" Typo="Typo.body1">@userSearch.TotalPointsClaimed.ToString("N0")</MudText>
            </MudPaper>
        </MudItem>
    </MudGrid>

    <MudText Typo="Typo.h3" Align="Align.Center" Class="pt-7 pb-5" Style="color: white;">Discord Stats</MudText>

    <MudGrid Justify="Justify.Center">
        <MudItem xs=4>
            <MudPaper Style="@($"background-color: {Colors.Indigo.Lighten1}; color: white;")" Elevation=5>
                <MudText Align="Align.Center" Class="pt-4" Typo="Typo.h6">Total Discord Daily Claims</MudText>
                <MudText Align="Align.Center" Class="pt-1 pb-4" Typo="Typo.body1">@userSearch.DiscordDailyTotalClaims.ToString("N0")</MudText>
            </MudPaper>
        </MudItem>
        <MudItem xs=4>
            <MudPaper Style="@($"background-color: {Colors.Indigo.Lighten1}; color: white;")" Elevation=5>
                <MudText Align="Align.Center" Class="pt-4" Typo="Typo.h6">Discord Level</MudText>
                <MudText Align="Align.Center" Class="pt-1 pb-4" Typo="Typo.body1">@userSearch.DiscordLevel.ToString("N0")</MudText>
            </MudPaper>
        </MudItem>
        <MudItem xs=4>
            <MudPaper Style="@($"background-color: {Colors.Indigo.Lighten1}; color: white;")" Elevation=5>
                <MudText Align="Align.Center" Class="pt-4" Typo="Typo.h6">Discord XP</MudText>
                <MudText Align="Align.Center" Class="pt-1 pb-4" Typo="Typo.body1">@userSearch.DiscordXP.ToString("N0")</MudText>
            </MudPaper>
        </MudItem>
    </MudGrid>

    <MudText Typo="Typo.h3" Align="Align.Center" Class="pt-7 pb-5" Style="color: white;">Misc Stats</MudText>

    <MudGrid Justify="Justify.Center">
        <MudItem xs=4>
            <MudPaper Style="@($"background-color: {Colors.Teal.Darken1}; color: white;")" Elevation=5>
                <MudText Align="Align.Center" Class="pt-4" Typo="Typo.h6">Marbols Wins</MudText>
                <MudText Align="Align.Center" Class="pt-1 pb-4" Typo="Typo.body1">@userSearch.MarblesWins.ToString("N0")</MudText>
            </MudPaper>
        </MudItem>
        <MudItem xs=4>
            <MudPaper Style="@($"background-color: {Colors.Teal.Darken1}; color: white;")" Elevation=5>
                <MudText Align="Align.Center" Class="pt-4" Typo="Typo.h6">Twitch Bosses Survived</MudText>
                <MudText Align="Align.Center" Class="pt-1 pb-4" Typo="Typo.body1">@userSearch.TwitchBossesDone.ToString("N0")</MudText>
            </MudPaper>
        </MudItem>
        <MudItem xs=4>
            <MudPaper Style="@($"background-color: {Colors.Teal.Darken1}; color: white;")" Elevation=5>
                <MudText Align="Align.Center" Class="pt-4" Typo="Typo.h6">Twitch Bosses Points Won</MudText>
                <MudText Align="Align.Center" Class="pt-1 pb-4" Typo="Typo.body1">@userSearch.TwitchBossesPointsWon.ToString("N0")</MudText>
            </MudPaper>
        </MudItem>
    </MudGrid>
}

@if(userSearch == null && !firstRender)
{
    <MudAlert Severity="Severity.Error">User not found!</MudAlert>
}

</MudContainer>
@code {
    private UserSearchData? userSearch = null;
    private bool firstRender = true;
    private string userSearchText = "";
    [Parameter] public string? Username { get; set; }

    async void HandleTextChanged(string changedText)
    {
        if(userSearchText == "")
        {
            return;
        }

        userSearch = UserSearchService.GetUserDataByTwitchUsername(userSearchText.ToLower());
        firstRender = false;
        StateHasChanged();
    }

    async void HandleAdornmentClick(MouseEventArgs click)
    {
        userSearch = UserSearchService.GetUserDataByTwitchUsername(userSearchText.ToLower());
        firstRender = false;
        StateHasChanged();
    }

    protected override async Task OnParametersSetAsync()
    {
        if(Username != null){
            userSearch = UserSearchService.GetUserDataByTwitchUsername(Username.ToLower());
            firstRender = false;
            StateHasChanged();
        }
    }
}
