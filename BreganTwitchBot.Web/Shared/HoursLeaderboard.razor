@using Data.Leaderboards
@using Data.Leaderboards.Enums

@inject LeaderboardsService Leaderboards

<MudText Typo="Typo.h2" Align="Align.Center" Class="pt-7 pb-5" Style="color: white;">Points</MudText>

<MudContainer MaxWidth="MaxWidth.Large">
    <MudTable Items="@Leaderboard" Hover=true Striped=true Style="background-color: #27272f;" Elevation=5 Filter="new Func<LeaderboardsHours, bool>(LeaderboardsFilterFunc)">
        <ToolBarContent>
            <MudText Typo="Typo.h6">@leaderboardName</MudText>
            <MudSpacer />
            <MudTextField @bind-Value="leaderboardsTable" Placeholder="Search" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium"></MudTextField>
        </ToolBarContent>
        <HeaderContent>
            <MudTh><MudTableSortLabel SortBy="new Func<LeaderboardsHours, object>(x=>x.Position)">Position</MudTableSortLabel></MudTh>
            <MudTh><MudTableSortLabel SortBy="new Func<LeaderboardsHours, object>(x=>x.Username)">Username</MudTableSortLabel></MudTh>
            <MudTh><MudTableSortLabel SortBy="new Func<LeaderboardsHours, object>(x=>x.Amount)">Amount</MudTableSortLabel></MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd DataLabel="Position">@context.Position</MudTd>
            <MudTd DataLabel="Username">@context.Username</MudTd>
            <MudTd DataLabel="Amount">@context.Amount</MudTd>
        </RowTemplate>
        <PagerContent>
            <MudTablePager />
        </PagerContent>
    </MudTable>
</MudContainer>

@code {
    private List<LeaderboardsHours> Leaderboard = new List<LeaderboardsHours>();
    private string leaderboardsTable = "";
    [Parameter] public LeaderboardType leaderboardType { get; set; }
    [Parameter] public string leaderboardName { get; set; } = "Leaderboard";

    protected override async Task OnInitializedAsync()
    {
        Leaderboard = Leaderboards.GetHourLeaderboard(leaderboardType);
    }

    private bool LeaderboardsFilterFunc(LeaderboardsHours command) => FilterFunc(command, leaderboardsTable);

    private bool FilterFunc(LeaderboardsHours command, string searchString)
    {
        if (string.IsNullOrWhiteSpace(searchString))
        {
            return true;
        }

        if (command.Username.Contains(searchString, StringComparison.OrdinalIgnoreCase))
        {
            return true;
        }

        return false;
    }
}
